data1=read_excel("data.xlsx",sheet = "lifehistory_trait")
meandat<-ddply(data1,.(latitude,longitude,block),summarize,growthrate=mean(growthrate),pupaltime=mean(pupaltime),larvaltime=mean(larvaltime),totaltime=mean(totaltime),pupalweight=mean(pupalweight),adultweight=mean(adultweight))
require (Rmisc)
require(ggplot2)
require(readxl)
require(dplyr)
data1=read_excel("data.xlsx",sheet = "lifehistory_trait")
meandat<-ddply(data1,.(latitude,longitude,block),summarize,growthrate=mean(growthrate),pupaltime=mean(pupaltime),larvaltime=mean(larvaltime),totaltime=mean(totaltime),pupalweight=mean(pupalweight),adultweight=mean(adultweight))
require(plyr)
meandat<-ddply(data1,.(latitude,longitude,block),summarize,growthrate=mean(growthrate),pupaltime=mean(pupaltime),larvaltime=mean(larvaltime),totaltime=mean(totaltime),pupalweight=mean(pupalweight),adultweight=mean(adultweight))
data2=read_excel("data.xlsx",sheet = "chill_comma")
chill_mean<-ddply(data2,.(latitude,longitude,block),summarize,ccrt=mean(ccrt))
data3=read_excel("data.xlsx",sheet = "heat_knock")
heat_mean<-ddply(data3,.(latitude,longitude,block),summarize,hkt=mean(knockdown_time))
data4=read_excel("data.xlsx",sheet = "starvation")
starvation_mean<-ddply(data4,.(latitude,longitude,block),summarize,starvation=mean(time))
data5=read_excel("data.xlsx",sheet = "desiccation")
desi_mean<-ddply(data5,.(latitude,longitude,block),summarize,desi=mean(time))
mod_desi=lm(time~latitude*sex*longitude,data=data5)
summary(mod_desi)
data_pca=data[,c("starvation","desi","hkt","ccrt","growthrate")]
pca=princomp(scale(data_pca))
summary(pca)
full_mean=cbind(meandat,chill_mean,heat_mean,starvation_mean,desi_mean)
write.csv(full_mean,"full_mean.csv")
data=read.csv("full_mean.csv")
data_pca=data[,c("starvation","desi","hkt","ccrt","growthrate")]
pca=princomp(scale(data_pca))
summary(pca)
pca$loadings[,1:3]
library(maps)
library(raster)
library(mapdata)
w<-getData('worldclim', var='bio', res=2.5)
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
full_mean=cbind(meandat,chill_mean,heat_mean,starvation_mean,desi_mean)
write.csv(full_mean,"full_mean.csv")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
full.dat<-data.frame(full_mean,scores)
names(full.dat)
full_mean=cbind(meandat,chill_mean,heat_mean,starvation_mean,desi_mean)
scores<-pca$scores[,1:2]
full.dat<-data.frame(full_mean,scores)
names(full.dat)
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
map.scale(x=80, y=40, ratio=FALSE, relwidth=0.2)
map.scale(x=80, y=25, ratio=FALSE, relwidth=0.2)
map.scale(x=80, y=20, ratio=FALSE, relwidth=0.2)
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
map.scale(x=80, y=20, ratio=FALSE, relwidth=0.2)
map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
library(GISTools)
install.packages("GISTools")
library(GISTools)
north.arrow(xb=15.75, yb=43.25, len=0.05, lab="N")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
north.arrow(xb=80, yb=21, len=0.05, lab="N")
north.arrow(xb=80, yb=21, len=0.1, lab="N")
north.arrow(xb=80, yb=21, len=1, lab="N")
north.arrow(xb=80, yb=21, len=.5, lab="N")
north.arrow(xb=80, yb=40, len=.5, lab="N")
north.arrow(xb=80, yb=45, len=.5, lab="N")
north.arrow(xb=80, yb=48, len=.5, lab="N")
north.arrow(xb=135, yb=20, len=.5, lab="N")
north.arrow(xb=130, yb=20, len=.5, lab="N")
north.arrow(xb=125, yb=20, len=.5, lab="N")
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
north.arrow(xb=125, yb=20, len=.5, lab="N")
k<-extract(w,full.dat[,c("longitude","latitude")])
map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
map::map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
north.arrow(xb=125, yb=20, len=.5, lab="N")
maps::map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
maps::map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
north.arrow(xb=125, yb=20, len=.5, lab="N")
k<-extract(w,full.dat[,c("longitude","latitude")])
north.arrow(xb=85, yb=22, len=.5, lab="N")
north.arrow(xb=85, yb=25, len=.5, lab="N")
map("china")
points(full.dat$longitude,full.dat$latitude,pch=20,col="red",cex=3)
maps::map.scale(x=80, y=20, ratio=FALSE, relwidth=0.1)
north.arrow(xb=85, yb=25, len=.5, lab="N")
k<-extract(w,full.dat[,c("longitude","latitude")])
full.dat2<-data.frame(full.dat,k)
str(full.dat2)
bio<-princomp(scale(k))
summary(bio)
bio$loadings[,1:3]
full.dat3<-data.frame(full.dat2,bioclim.pc)
str(full.dat3)
summary(lm(Comp.1~bio1,data=full.dat3))
summary(lm(Comp.1~bio15,data=full.dat3))
ggplot(full.dat3,aes(x=latitude,y=Comp.1.1))+stat_smooth()+geom_point()
bioclim.pc<-bio$scores[,1:3]
full.dat3<-data.frame(full.dat2,bioclim.pc)
str(full.dat3)
summary(lm(Comp.1~bio1,data=full.dat3))
summary(lm(Comp.1~bio15,data=full.dat3))
summary(lm(desi~bio5,data=full.dat3))
summary(lm(latitude~Comp.1.1,data=full.dat3))
ggplot(full.dat3,aes(x=latitude,y=Comp.1.1))+stat_smooth()+geom_point()
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth()+geom_point()
ggplot(full.dat3,aes(x=latitude,y=Comp.1.1))+stat_smooth()+geom_point()
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth()+geom_point()
dat3.sub%>%
filter(Comp.1.1>-5)
dat3.sub<-dat3%>%
filter(Comp.1.1>-5)
dat3.sub<-full.dat3%>%
filter(Comp.1.1>-5)
ggplot(dat3.sub,aes(x=Comp.1.1,y=Comp.1))+stat_smooth()+geom_point()
ggplot(dat3.sub,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()
summary(lm(Comp.1~Comp.1.1,data=full.dat3))
summary(lm(Comp.1~Comp.1.1+I(Comp.1.1^2),data=full.dat3))
?stat_smooth()
ggplot(dat3.sub,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm".formula= y~x +I(x^2),size=1)+geom_point()
ggplot(dat3.sub,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Traits (PC1)")+xlab("Climate (PC1)")
bio$loadings[,1:3]
summary(bio)
summary(lm(Comp.1~Comp.1.1+I(Comp.1.2^2),data=full.dat3))
summary(lm(Comp.1~Comp.1.1+I(Comp.2.1^2),data=full.dat3))
summary(lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+I(Comp.2.1^2),data=full.dat3))
summary(lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3))
summary(lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3.1+I(Comp.3.1^2),data=full.dat3))
bioclim.pc<-bio$scores[,1:3]
full.dat3<-data.frame(full.dat2,bioclim.pc)
str(full.dat3)
summary(lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3))
fullcompmod<-lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
summary(stepAIC(fullcompmod,direction="both"))
summary(bio)
bio$loadings[,1:3]
summary(bio)
summary(pca)
summary(pca)
pca$loadings[,1:3]
summary(stepAIC(fullcompmod,direction="both"))
fullcompmod2<-lm(Comp.2~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
summary(stepAIC(fullcompmod2,direction="both"))
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Traits (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Traits (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC2)")
ggplot(full.dat3,aes(x=Comp.3.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC2)")
ggplot(full.dat3,aes(x=Comp.3,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC2)")
ggplot(full.dat3,aes(x=Comp.3,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC3)")
fullcompmod3<-lm(Comp.3~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
fullcompmod3<-lm(Comp.3~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
fullcompmod3<-lm(pca$scores[,3]~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
summary(stepAIC(fullcompmod3,direction="both"))
ggplot(full.dat3,aes(x=Comp.3,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC3)")
ggplot(full.dat3,aes(x=Comp.3,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC3)")
fullcompmod<-lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
summary(stepAIC(fullcompmod,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC2)")
ggplot(full.dat3,aes(x=Comp.3,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC2)")
ggplot(full.dat3,aes(x=Comp.3,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC3)")
ggplot(full.dat3,aes(x=Comp.3,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC3)")
fullcompmod2<-lm(Comp.2~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
summary(stepAIC(fullcompmod2,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC2)")
ggplot(full.dat3,aes(x=Comp.3,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC3)")
summary(stepAIC(fullcompmod2,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC1)")
summary(stepAIC(fullcompmod2,direction="both"))
fullcompmod3<-lm(pca$scores[,3]~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2)+Comp.3+I(Comp.3^2),data=full.dat3)
summary(stepAIC(fullcompmod3,direction="both"))
ggplot(full.dat3,aes(x=Comp.3,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC3)")
summary(stepAIC(fullcompmod,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.3,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC3)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
fullcompmod<-lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC3)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC3)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
str(data1)
data$6
data6
str(data5)
112/24
fullcompmod3<-lm(pca$scores[,3]~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod3,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC3)")
ggplot(full.dat3,aes(x=Comp.2.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC3)")
ggplot(full.dat3,aes(x=Comp.1.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC1)")
summary(stepAIC(fullcompmod3,direction="both"))
fullcompmod2<-lm(Comp.2~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod2,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC1)")
summary(stepAIC(fullcompmod2,direction="both"))
fullcompmod3<-lm(pca$scores[,3]~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod3,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC2)")
fullcompmod<-lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
summary(stepAIC(fullcompmod,direction="both"))
dat3.sub<-full.dat3%>%
filter(Comp.1.1>-5)
ggplot(dat3.sub,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()
fullcompmod<-lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
resid(lm(Comp.1~Comp.1.1+I(Comp.1.1^2),data=full.dat3))
full.dat3$resid1<-resid(lm(Comp.1~Comp.1.1+I(Comp.1.1^2),data=full.dat3))
ggplot(full.dat3,aes(x=Comp.2.1,y=resid1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
fullcompmod2<-lm(Comp.2~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod2,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC1)")
citation()
require (Rmisc)
require(ggplot2)
require(readxl)
require(plyr)
data1=read_excel("data.xlsx",sheet = "lifehistory_trait")
meandat<-ddply(data1,.(latitude,longitude,block),summarize,growthrate=mean(growthrate),pupaltime=mean(pupaltime),larvaltime=mean(larvaltime),totaltime=mean(totaltime),pupalweight=mean(pupalweight),adultweight=mean(adultweight))
data2=read_excel("data.xlsx",sheet = "chill_comma")
chill_mean<-ddply(data2,.(latitude,longitude,block),summarize,ccrt=mean(ccrt))
data3=read_excel("data.xlsx",sheet = "heat_knock")
heat_mean<-ddply(data3,.(latitude,longitude,block),summarize,hkt=mean(knockdown_time))
data4=read_excel("data.xlsx",sheet = "starvation")
starvation_mean<-ddply(data4,.(latitude,longitude,block),summarize,starvation=mean(time))
data5=read_excel("data.xlsx",sheet = "desiccation")
desi_mean<-ddply(data5,.(latitude,longitude,block),summarize,desi=mean(time))
mod_desi=lm(time~latitude*sex*longitude,data=data5)
summary(mod_desi)
full_mean=cbind(meandat,chill_mean,heat_mean,starvation_mean,desi_mean)
write.csv(full_mean,"full_mean.csv")
data=read.csv("full_mean.csv")
data_pca=data[,c("starvation","desi","hkt","ccrt","growthrate")]
pca=princomp(scale(data_pca))
summary(pca)
pca$loadings[,1:3]
scores<-pca$scores[,1:2]
full.dat<-data.frame(full_mean,scores)
names(full.dat)
ggplot(full.dat,aes(x=latitude,y=Comp.1))+geom_point()+stat_smooth()
summary(lm(Comp.1~latitude+I(latitude^2)+I(latitude^3),data=full.dat))
ggplot(data,aes(x=starvation,y=growthrate))+geom_point()+geom_smooth(method="lm",se=F)
mod1=lm(growthrate~desi*block*sex,data=data)
summary(step(mod1,direction=c("both")))
mod2=lm(growthrate~latitude*hkt*block*sex,data=data)
summary(step(mod2,direction=c("both")))
library(maps)
library(raster)
library(mapdata)
plot(w,4,xlim=c(80,140),ylim=c(15,50), legend=F, col="white",main="",box=FALSE)
w<-getData('worldclim', var='bio', res=2.5)
plot(w,4,xlim=c(80,140),ylim=c(15,50), legend=F, col="white",main="",box=FALSE)
map("world",c("China"),add=TRUE)
points(full.dat$longitude,full.dat$latitude,pch=20,col="black",cex=3)
k<-extract(w,full.dat[,c("longitude","latitude")])
full.dat2<-data.frame(full.dat,k)
str(full.dat2)
bio<-princomp(scale(k))
summary(bio)
bio$loadings[,1:3]
bio<-princomp(scale(k))
summary(bio)
bio$loadings[,1:3]
bioclim.pc<-bio$scores[,1:3]
full.dat3<-data.frame(full.dat2,bioclim.pc)
str(full.dat3)
summary(lm(Comp.1~bio1,data=full.dat3))
summary(lm(Comp.1~bio15,data=full.dat3))
summary(lm(desi~bio5,data=full.dat3))
summary(lm(latitude~Comp.1.1,data=full.dat3))
ggplot(full.dat3,aes(x=latitude,y=Comp.1.1))+stat_smooth()+geom_point()
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth()+geom_point()
dat3.sub<-full.dat3%>%
filter(Comp.1.1>-5)
ggplot(dat3.sub,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm")+geom_point()
fullcompmod<-lm(Comp.1~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.1))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
full.dat3$resid1<-resid(lm(Comp.1~Comp.1.1+I(Comp.1.1^2),data=full.dat3))
ggplot(full.dat3,aes(x=Comp.2.1,y=resid1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
full.dat3$resid0<-resid(lm(Comp.1~Comp.2.1+I(Comp.2.1^2),data=full.dat3))
ggplot(full.dat3,aes(x=Comp.1.1,y=resid0))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
a<-ggplot(full.dat3,aes(x=Comp.1.1,y=resid0))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Climate (PC1)")
b<-ggplot(full.dat3,aes(x=Comp.2.1,y=resid1))+stat_smooth(method="lm")+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
library(gridExtra)
grid.arrange(a,b,ncol=2)
b<-ggplot(full.dat3,aes(x=Comp.2.1,y=resid1))+stat_smooth(method="lm")+geom_point()#+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
library(gridExtra)
grid.arrange(a,b,ncol=2)
b<-ggplot(full.dat3,aes(x=Comp.2.1,y=resid1))+stat_smooth(method="lm")+geom_point()+ylab("")#+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Overall Precipitation (PC2)")
library(gridExtra)
grid.arrange(a,b,ncol=2)
b<-ggplot(full.dat3,aes(x=Comp.2.1,y=resid1))+stat_smooth(method="lm")+geom_point()+ylab("")+xlab("Overall Precipitation (PC2)")#+ylab("Growth rate-hardiness trade-off (PC1)")
grid.arrange(a,b,ncol=2)
a<-ggplot(full.dat3,aes(x=Comp.1.1,y=resid0))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Growth rate-hardiness trade-off (PC1)")+xlab("Seasonal to Aseasonal Cliamte (PC1)")
full.dat3$resid1<-resid(lm(Comp.1~Comp.1.1+I(Comp.1.1^2),data=full.dat3))
b<-ggplot(full.dat3,aes(x=Comp.2.1,y=resid1))+stat_smooth(method="lm")+geom_point()+ylab("")+xlab("Overall Precipitation (PC2)")#+ylab("Growth rate-hardiness trade-off (PC1)")
library(gridExtra)
grid.arrange(a,b,ncol=2)
fullcompmod2<-lm(Comp.2~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod2,direction="both"))
library(MASS)
fullcompmod2<-lm(Comp.2~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod2,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.1.1,y=Comp.2))+stat_smooth(method="lm",size=1)+geom_point()+ylab("Thermal Tolerance trade-off (PC2)")+xlab("Seasonal to Aseasonal Climate (PC1)")
fullcompmod3<-lm(pca$scores[,3]~Comp.1.1+I(Comp.1.1^2)+Comp.2.1+I(Comp.2.1^2),data=full.dat3)
summary(stepAIC(fullcompmod3,direction="both"))
ggplot(full.dat3,aes(x=Comp.1.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Climate (PC2)")
ggplot(full.dat3,aes(x=Comp.1.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Seasonal to Aseasonal Climate (PC1)")
ggplot(full.dat3,aes(x=Comp.2.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Overall Precipitation (PC2)")
c<-ggplot(full.dat3,aes(x=Comp.1.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Seasonal to Aseasonal Climate (PC1)")
d<-ggplot(full.dat3,aes(x=Comp.2.1,y=pca$scores[,3]))+stat_smooth(method="lm",formula= y~x +I(x^2),size=1)+geom_point()+ylab("Desiccation/Starvation - Thermal Tolerance Trade-off (PC3)")+xlab("Overall Precipitation (PC2)")
grid.arrange(c,d,ncol=2)
